<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dumont Cloud - Live Docs</title>

    <!-- GitHub Markdown CSS (Light) -->
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/5.5.0/github-markdown-light.min.css">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Marked.js -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <!-- Mermaid.js -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Merriweather:ital,wght@0,300;0,400;0,700;1,400&family=Inter:wght@400;500;600&display=swap"
        rel="stylesheet">

    <style>
        /* Theme Configuration: "Pastel / Paper" */
        :root {
            --bg-body: #f7f6f3;
            /* Notion-like Pastel Gray/Cream */
            --bg-sidebar: #eae9e5;
            /* Slightly darker pastel for sidebar */
            --text-primary: #37352f;
            /* Soft Dark Gray */
            --text-secondary: #74726e;
            --accent-color: #2ea043;
            /* GitHub Green / Dumont Green */
            --border-color: #dcdcd9;
        }

        body {
            background-color: var(--bg-body);
            color: var(--text-primary);
            margin: 0;
            overflow: hidden;
            font-family: 'Inter', sans-serif;
        }

        /* Sidebar Styling */
        .sidebar {
            background-color: var(--bg-sidebar);
            border-right: 1px solid var(--border-color);
        }

        /* Nav Items */
        .nav-item {
            color: var(--text-primary);
            border-radius: 6px;
            transition: background 0.2s;
        }

        .nav-item:hover {
            background-color: rgba(0, 0, 0, 0.05);
        }

        .nav-item.active {
            background-color: white;
            color: var(--accent-color);
            font-weight: 600;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
            border-left: none;
            /* Reset sidebar border style */
        }

        /* Markdown Overrides for "Pleasant Reading" */
        .markdown-body {
            background-color: transparent !important;
            color: var(--text-primary) !important;
            font-family: 'Merriweather', serif;
            /* Serif for main content text - very readable */
            font-size: 13px;
            line-height: 1.6;
            max-width: 800px;
            /* Reading optimial line length */
            margin: 0 auto;
        }

        .markdown-body h1,
        .markdown-body h2,
        .markdown-body h3 {
            font-family: 'Inter', sans-serif;
            /* Sans-serif for headers */
            border-bottom-color: var(--border-color) !important;
            color: #111 !important;
        }

        .markdown-body pre {
            background-color: #f0f0f0 !important;
            border: 1px solid var(--border-color);
            border-radius: 8px;
        }

        .markdown-body blockquote {
            border-left-color: var(--accent-color) !important;
            background-color: #fff !important;
            padding: 16px;
            font-style: italic;
            border-radius: 4px;
        }

        .markdown-body table tr {
            background-color: transparent !important;
            border-color: var(--border-color) !important;
        }

        .markdown-body table tr:nth-child(2n) {
            background-color: rgba(0, 0, 0, 0.02) !important;
        }

        .markdown-body th,
        .markdown-body td {
            border-color: var(--border-color) !important;
        }

        /* Mermaid Centering */
        .mermaid {
            display: flex;
            justify-content: center;
            background: white;
            padding: 24px;
            border-radius: 8px;
            margin: 24px 0;
            border: 1px solid var(--border-color);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.02);
        }
    </style>
</head>

<body class="h-screen flex flex-col md:flex-row">

    <!-- Mobile Header -->
    <div class="md:hidden flex items-center justify-between p-4 bg-[#eae9e5] border-b border-[#dcdcd9]">
        <span class="font-bold text-[#37352f]">üìö Live Docs</span>
        <button id="menu-toggle" class="text-[#37352f]">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16">
                </path>
            </svg>
        </button>
    </div>

    <!-- Sidebar -->
    <aside id="sidebar"
        class="sidebar w-full md:w-64 flex-shrink-0 flex flex-col h-full absolute md:relative transform -translate-x-full md:translate-x-0 transition-transform duration-200 z-50 shadow-xl md:shadow-none">
        <div class="p-6">
            <h1 class="text-lg font-bold text-[#37352f] tracking-tight flex items-center gap-2">
                <svg class="w-5 h-5 text-emerald-600" fill="currentColor" viewBox="0 0 24 24">
                    <path
                        d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z" />
                </svg>
                Dumont Cloud
            </h1>
            <p class="text-xs text-gray-500 mt-1 uppercase tracking-wide">Live Docs</p>
        </div>

        <nav class="flex-1 overflow-y-auto px-4 py-2">
            <div class="mb-6">
                <p class="text-xs font-semibold text-gray-400 uppercase tracking-wider mb-3 px-2">Strategy</p>
                <button onclick="loadDoc('marketing')" id="nav-marketing"
                    class="nav-item w-full text-left px-3 py-2 text-sm mb-1 flex items-center gap-2">
                    <span class="text-emerald-600">üìä</span> Marketing Roadmap
                </button>
            </div>

            <div class="mb-6">
                <p class="text-xs font-semibold text-gray-400 uppercase tracking-wider mb-3 px-2">Engineering</p>
                <button onclick="loadDoc('readme')" id="nav-readme"
                    class="nav-item w-full text-left px-3 py-2 text-sm mb-1 flex items-center gap-2">
                    <span class="text-blue-600">üõ†Ô∏è</span> Project README
                </button>
            </div>
        </nav>

        <div class="p-4 border-t border-[#dcdcd9]">
            <a href="https://dumontcloud.com/app"
                class="block w-full text-center py-2 px-4 rounded border border-[#dcdcd9] bg-white text-xs text-[#37352f] hover:bg-gray-50 transition-colors shadow-sm">
                ‚Üê Voltar para App
            </a>
        </div>
    </aside>

    <!-- Overlay -->
    <div id="overlay" class="fixed inset-0 bg-black/20 z-40 hidden md:hidden glass-overlay"></div>

    <!-- Main Content -->
    <main class="flex-1 overflow-y-auto relative bg-[#f7f6f3]">
        <!-- Markdown Container -->
        <article class="max-w-4xl mx-auto px-6 py-12 md:px-12 md:py-16">
            <div id="content" class="markdown-body">
                <!-- Content Loads Here -->
                <div class="flex flex-col items-center justify-center h-64 text-gray-400">
                    <svg class="animate-spin h-8 w-8 text-emerald-500 mb-4" xmlns="http://www.w3.org/2000/svg"
                        fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4">
                        </circle>
                        <path class="opacity-75" fill="currentColor"
                            d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                        </path>
                    </svg>
                    Carregando documenta√ß√£o...
                </div>
            </div>

            <footer class="mt-20 pt-8 border-t border-[#dcdcd9] text-center text-xs text-gray-400">
                <p>Live Documentation System ‚Ä¢ Dumont Cloud &copy; 2025</p>
            </footer>
        </article>
    </main>

    <script>
        // Mermaid Init (Neutral/Light Theme)
        mermaid.initialize({ startOnLoad: false, theme: 'neutral' });

        // Sidebar Configuration
        const menuToggle = document.getElementById('menu-toggle');
        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('overlay');
        const navContainer = document.querySelector('nav');

        // Mobile Menu
        function toggleMenu() {
            sidebar.classList.toggle('-translate-x-full');
            overlay.classList.toggle('hidden');
        }
        menuToggle.addEventListener('click', toggleMenu);
        overlay.addEventListener('click', toggleMenu);

        // Fetch Menu
        async function loadMenu() {
            try {
                const res = await fetch('/api/menu');
                const data = await res.json();
                renderMenu(data.menu, navContainer);

                // Load first available doc by default
                const firstDoc = findFirstDoc(data.menu);
                if (firstDoc) {
                    loadDoc(firstDoc);
                } else {
                    document.getElementById('content').innerHTML = '<div class="p-8 text-center text-gray-500">Nenhum documento encontrado. Adicione arquivos .md em Live-Doc/content/</div>';
                }

            } catch (err) {
                console.error("Menu Load Error:", err);
            }
        }

        // Recursive Menu Renderer
        function renderMenu(items, container) {
            container.innerHTML = '';

            items.forEach(item => {
                const div = document.createElement('div');
                div.className = 'mb-6';

                if (item.type === 'dir') {
                    // Section Header
                    const header = document.createElement('p');
                    header.className = 'text-xs font-semibold text-gray-400 uppercase tracking-wider mb-3 px-2';
                    header.textContent = item.name.replace(/_/g, ' ');
                    div.appendChild(header);

                    // Recursive Children
                    const childrenContainer = document.createElement('div');
                    renderRecursiveItems(item.children, childrenContainer);
                    div.appendChild(childrenContainer);
                } else {
                    // Root level files
                    renderFileItem(item, div);
                }

                container.appendChild(div);
            });
        }

        function renderRecursiveItems(items, container) {
            items.forEach(item => {
                if (item.type === 'file') {
                    renderFileItem(item, container);
                } else if (item.type === 'dir') {
                    // Nested Submenus could go here
                }
            });
        }

        function renderFileItem(item, container) {
            const btn = document.createElement('button');
            btn.onclick = () => loadDoc(item.id);
            btn.id = `nav-${item.id}`;
            btn.className = 'nav-item w-full text-left px-3 py-2 text-sm mb-1 flex items-center gap-2';
            btn.innerHTML = `<span class="text-gray-400">üìÑ</span> ${item.name}`;
            container.appendChild(btn);
        }

        function findFirstDoc(items) {
            for (const item of items) {
                if (item.type === 'file') return item.id;
                if (item.type === 'dir' && item.children) {
                    const child = findFirstDoc(item.children);
                    if (child) return child;
                }
            }
            return null;
        }

        // Fetch Content
        async function loadDoc(id) {
            const contentDiv = document.getElementById('content');
            contentDiv.style.opacity = '0.5';

            // Active State
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            // Escape special chars in ID for selector
            const safeId = CSS.escape(`nav-${id}`);
            const activeBtn = document.querySelector(`#${safeId}`);
            if (activeBtn) activeBtn.classList.add('active');

            try {
                // Encode path components (preserves slashes, encodes spaces)
                const res = await fetch(`/api/content/${encodeURI(id)}`);

                if (!res.ok) throw new Error("Doc not found");

                const data = await res.json();

                if (data.content) {
                    contentDiv.innerHTML = marked.parse(data.content);

                    // Render Mermaid
                    const mermaidBlocks = contentDiv.querySelectorAll('.language-mermaid');
                    mermaidBlocks.forEach(block => {
                        const pre = block.parentElement;
                        const div = document.createElement('div');
                        div.className = 'mermaid';
                        div.textContent = block.textContent;
                        pre.replaceWith(div);
                    });

                    await mermaid.run();
                } else {
                    contentDiv.innerHTML = '<h1>Documento n√£o encontrado</h1>';
                }
            } catch (err) {
                console.error(err);
                contentDiv.innerHTML = `<div class="text-red-500 p-4">Erro ao carregar documento: ${id}</div>`;
            }

            contentDiv.style.opacity = '1';
            if (window.innerWidth < 768) sidebar.classList.add('-translate-x-full');
        }

        // Init
        document.addEventListener('DOMContentLoaded', loadMenu);
    </script>
</body>

</html>